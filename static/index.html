<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Friday Chat</title>
<link rel="stylesheet" href="/static/styles.css" />
</head>

<body>

<!-- HEADER -->
<header>
  <div class="header-inner">
    <button id="menuBtn" class="menu-btn">☰</button>

    <div class="logo-wrap">
      <svg width="32" height="32" viewBox="0 0 64 64">
        <defs>
          <linearGradient id="g1" x1="0" x2="1">
            <stop offset="0" stop-color="#7dd3fc"/>
            <stop offset="1" stop-color="#60a5fa"/>
          </linearGradient>
        </defs>
        <circle cx="32" cy="32" r="30" fill="url(#g1)"/>
        <path d="M18 38c6-8 16-12 26-9"
          stroke="#fff" stroke-width="3" fill="none"
          stroke-linecap="round"/>
      </svg>
      <div class="title">FRIDAY IS ONLINE</div>
    </div>

    <div style="width:36px;"></div>
  </div>
</header>

<!-- MAIN CHAT AREA -->
<div class="container">
  <div id="chatArea">
    <div class="messages" id="messages"></div>

    <div class="composer">
      <input id="inp" class="input" placeholder="Message Friday..." />
      <button id="sendBtn" class="send-btn">
        <svg width="20" height="20" viewBox="0 0 24 24">
          <path d="M4 11.5L20 3v18L4 11.5z" fill="currentColor"/>
        </svg>
      </button>
    </div>
  </div>
</div>

<!-- DRAWER -->
<div id="backdrop" class="drawer-backdrop"></div>
<div id="drawer" class="drawer">
  <div class="new-chat" id="newChat">➕ New Chat</div>
  <div class="recent-list"></div>
</div>


<script>
/* DOM */
const messages = document.getElementById("messages");
const input = document.getElementById("inp");
const sendBtn = document.getElementById("sendBtn");

/* SCROLL */
function scrollBottom(){
  messages.scrollTop = messages.scrollHeight;
}

/* USER BUBBLE */
function userBubble(text){
  const div = document.createElement("div");
  div.className = "message-row";
  div.innerHTML = `<div class="msg user">${text}</div>`;
  return div;
}

/* FRIDAY MESSAGE WITH CODE SUPPORT */
function fridayBubble(text){
  const row = document.createElement("div");
  row.className = "message-row";

  if(text.includes("```")){
    let code = text.split("```")[1];

    row.innerHTML = `
      <div class="msg friday">
        <div class="code-block">
          <button class="copy-btn" onclick="copyCode(this)">Copy</button>
          ${code.replace(/</g,"&lt;")}
        </div>
      </div>`;
  } else {
    row.innerHTML = `<div class="msg friday">${text}</div>`;
  }

  return row;
}

/* COPY BUTTON */
function copyCode(btn){
  let code = btn.parentElement.innerText.replace("Copy","");
  navigator.clipboard.writeText(code);
  btn.innerText = "Copied!";
  setTimeout(()=>btn.innerText="Copy",1000);
}

/* SEND MESSAGE */
async function sendMessage(){
  let txt = input.value.trim();
  if(!txt) return;

  input.value = "";
  messages.appendChild(userBubble(txt));
  scrollBottom();

  let typing = document.createElement("div");
  typing.className = "message-row";
  typing.innerHTML = `
    <div class="msg friday typing">
      <span class="dot"></span><span class="dot"></span><span class="dot"></span>
    </div>`;
  messages.appendChild(typing);
  scrollBottom();

  let r = await fetch("/chat", {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({message:txt})
  });

  let data = await r.json();
  typing.remove();

  messages.appendChild(fridayBubble(data.reply));
  scrollBottom();
}

sendBtn.onclick = sendMessage;
input.onkeydown = (e)=>{ if(e.key==="Enter") sendMessage(); };


/* DRAWER OPEN/CLOSE */
const drawer = document.getElementById("drawer");
const backdrop = document.getElementById("backdrop");
menuBtn.onclick = ()=>{
  drawer.style.transform = "translateX(0)";
  backdrop.style.display = "block";
};
backdrop.onclick = ()=>{
  drawer.style.transform = "translateX(100%)";
  backdrop.style.display = "none";
};

newChat.onclick = ()=>{
  messages.innerHTML = "";
  drawer.style.transform = "translateX(100%)";
  backdrop.style.display = "none";
};

</script>

</body>
</html>